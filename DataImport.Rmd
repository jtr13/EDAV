---
title: "Data Import"
---

## Overview

This section covers how to import data source from R built-in source, local files, web source and database. 

## Import built-in dataset

R comes with quite a lot of built-in datasets, which R user can play around with R functions and do analysis. Many of those built-in datasets are those we are very familiar with, like `iris`, `mtcars`, `beavers`, `dataset`, etc. Those datasets are preloaded, so you can manipulate them directly. To see a full list of r built-in dataset and their description, please refer to [The R Datasets Package](https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/00Index.html). we can also run `data()` to view the full list.

After we find the dataset we want, we can use the function data(package_name) to load the built-in dataset into our workspace. For example, we want to load `iris` data.

```{r}
# load data
data("iris")
head(iris)
```

Besides the data sets above, there are other datasets along with the specific R packages. To see a full list of data in various packages, run command `??datasets` in the RStudio Console.
Now, we want to load the `diamonds` dataset from the `ggplot2` package. To load `diamonds` data, first we need to load `ggplot2` library.

```{r}
library(ggplot2)

data("diamonds")
head(diamonds)
```

## Import local data

### Import .txt file

The function `read.table()` is the mostly general used function for reading text files. To use this function, we need to specify on how we read this file. In other words, we need to specify some basic parameters like `sep`, `header`, etc. `sep` represent the seperator and `header` is set to `TRUE` if we want to regard the first line as the header information. Other parameters are also useful in different case. For example, `na.strings` indicate the strings to be regarded as NA value.

```{r}
df <- read.table("data/MusicIcecream.csv", sep=",", header=TRUE)
head(df)
```

### Import .CSV file
A comma-separated values file (CSV) is a delimited text file that uses a comma to separate values. We can easily read a CSV file with R built-in functions. 

`read.csv()` function provides two useful paramters. One is `header`, which could be set to `FALSE` if there is no header. The other is `sep`, which specifies the seperator. For example, we can specify the seperator to be like `sep="\t` if the CSV file value is seperated by tab character. The default value of `header` and `sep` are `TRUE` and `","`, respectively. 

`read.csv2()` is another function for reading CSV file. The difference between `read.csv()` and `read.csv2` is that, the former use the tab `"\t"` as the seperator, while the latter one use the semicolon `";"`. 

Let's see an example on reading a standard CSV file. 
```{r}
df <- read.csv("data/MusicIcecream.csv")
head(df)
```

A tiny skill while reading multiple files, is to let R know your current directory by using `setwd()`. Then you can read any file in this directory by directly set filename parameter to be the name of the file, without specifying the location. 

### Import .JSON file

A JSON file is a file that stores simple data structures and objects in JavaScript Object Notation (JSON) format, which is a standard data interchange format. For example, `{"name":"Vince", "age":23, "city":"New York"}` is an object with JSON format. In recent years, JSON become the mainstream format to tranfer data on the website. 

To read a JSON file, we can use `jsonlite` package. The `jsonlite` package is a JSON parser/generator optimized for the web. Its main strength is that it implements a bidirectional mapping between JSON data and the most important R data types. In the example below, the argument `simplifyDataFrame = TRUE` will directly transform list of JSON object into Data Frame. Besides, if you want to know the argument `simplifyVector` and `simplifyMatrix` which have flexible control on other R data formats to transfrom, please refer to [Getting started with JSON and jsonlite](https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html).

```{r}
library(jsonlite)

# read JSON data
raw_json_data <- fromJSON(txt = "data/WaterConsumptionInNYC.json", simplifyDataFrame = TRUE)

# transform JSON to Data Frame
df <- as.data.frame(raw_json_data)
head(df)
```

## Import web data

We can import data from the web, as long as we have the link to the dataset. Basically, there are two ways to import web data. One way is to scratch the dataset with the link before we import that data into the R workspace. The other way is to directly import the dataset from the web to our workspace. 

Let's take the `Water Consumption In The New York City` for example, which is on the [NYC Open Data website](https://data.cityofnewyork.us/Environment/Water-Consumption-In-The-New-York-City/ia2d-e54m). 

### Scrape web data to local space/memory before importing it

To securely access the web data, we can use `RCurl` package. More resources on [The RCurl Package](http://www.omegahat.net/RCurl/). More flexibly, we can first download the data to local hard drive and then read them as local files. To download the file, we can use the commands like `curl` : [Downloading files with curl](http://www.compciv.org/recipes/cli/downloading-with-curl/), `wget` : [Wget Command Examples](https://www.rosehosting.com/blog/wget-command-examples/), or just download it with browser.

```{r, echo=FALSE, message=FALSE}
library('RCurl')

# specify the url link to the data source
url <- "https://data.cityofnewyork.us/api/views/ia2d-e54m/rows.csv"

# read the data to memory
url_data <- getURI(url)

# we use textConnection to tell R to read data in text format
df <- read.table(textConnection(url_data), sep = ",", header = TRUE)
head(df)

```

### Directly read web source into the workspace

We still take the water consumption data as example. We specify the correct data url, and then read the data just like reading the local dataset.

```{r}
# specify the url link to the data source
url <- "https://data.cityofnewyork.us/api/views/ia2d-e54m/rows.csv"

# read the url
df <- read.table(url, sep = ",", header = TRUE)
head(df)

```

## Import data from database

R provide packages to manipulate data from relational database like PostgreSQL, MySQL, etc. One of those packages is `odbc` package, which is one database interface for communication between R and relational database management systems. More resources on package [odbc](https://db.rstudio.com/odbc/). 

Before we connect to local database, we must satify the requirement of ODBC driver, through which our R package can communicate with database. To get a help on how to install ODBC driver on systems like Windows, Linux, MacOS, please refer to this document: [Install ODBC Driver](https://cran.r-project.org/web/packages/odbc/readme/README.html).

After we installed the ODBC driver, with `odbc` package, we are able to manipulate database. To read a table in the database, we usually take steps as follows. First, we build the connection to the database with connection parameters specified. Then, we can do some exploratory operation like listing all tables in the database. To query the data we want, we can send a SQL query into the database and retrive the wanted data. 

```{r, eval=FALSE}
if(!require('odbc')) install.packages('odbc')
library(odbc)
library(DBI)

# build connection with database 
con <- dbConnect(odbc::odbc(),
  driver = "PostgreSQL Driver",
  database = "test_db",
  uid = "postgres",
  pwd = "password",
  host = "localhost",
  port = 5432)

# list all tables in the test_db database
dbListTables(con)

# read table test_table into Data Frame
data <- dbReadTable(con, "test_table")

# write an R Data Frame object to an SQL table
# here we write the built-in data mtcars to a new_table in DB
data <- dbWriteTable(con, "new_table", mtcars)

# SQL query
result <- dbSendQuery(con, "SELECT * FROM test_table")

# Retrieve the first 10 results
first_10 <- dbFetch(result, n = 10)
# Retrieve the rest of the results
rest <- dbFetch(result)

# close the connection
dbDisconnect(con)

```

## More resources

  - Import local file:
  [This R Data Import Tutorial Is Everything You Need](https://www.datacamp.com/community/tutorials/r-data-import-tutorial#Getting)
  - Import JSON file: 
  [Getting started with JSON and jsonlite](https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html)
  - Import web data:
  [The RCurl Package](http://www.omegahat.net/RCurl/)
  - Import database file
  [Databases using R](https://db.rstudio.com/)
  - Documentation on odbc package
  [odbc](https://db.rstudio.com/odbc/)
  - Install ODBC Driver On Your System
  [Install ODBC Driver](https://cran.r-project.org/web/packages/odbc/readme/README.html)
