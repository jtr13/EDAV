---
title: "Tidyquant"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Overview
This section covers how to use Tidyquant package to conduct timeseries analysis.

## What is Tidyquant?

Tidyquant is an one-stop shop package for financial analysis. It is suitable for analyzing timeseries data, such as financial and economic data. Tidyquant connects to various data sources such as Yahoo! finance, morning star, Bloomberg market data, and etc. Tidyquant integrates quantmod, xts, etc. with tidyverse.

For more information, please refer to following sources: https://cran.r-project.org/web/packages/tidyquant/vignettes/TQ00-introduction-to-tidyquant.html
https://github.com/business-science/tidyquant

## Installing Tidyquant
For installing Tidyquant, you can run following codes.
```{r}
# install.packages("tidyquant")
library(tidyquant)
```

If you want to see which functions are available, you can run following code.
```{r}
# to see which functions are available
tq_transmute_fun_options()
```

## Simple example 1: Analyzing a single timeseries
Obtain historical data for single stock (for example, Google).
```{r}
# get historical data for single stock. e.g. google
tq_get("GOOGL", get="stock.prices")
```

Calculate monthly return of single stock (for example, Google).
```{r}
# calculate monthly return of single stock
tq_get(c("GOOGL"), get="stock.prices") %>%
  tq_transmute(select=adjusted,
               mutate_fun=periodReturn,
               period="monthly",
               col_rename = "monthly_return")
```

Create a line chart of the closing price for single stock (for example, Google).
```{r}
# showing closing price for single stock
tq_get(c("GOOGL"), get="stock.prices") %>%
  ggplot(aes(date, close)) +
  geom_line()
```

Create a line chart of the monthly return for single stock (for example, Google).
```{r}
# showing monthly return for single stock
tq_get(c("GOOGL"), get="stock.prices") %>%
  tq_transmute(select=adjusted,
               mutate_fun=periodReturn,
               period="monthly",
               col_rename = "monthly_return") %>%
  ggplot(aes(date, monthly_return)) +
  geom_line()
```

## Simple example 2: Analyzing multiple timeseries
Obtain historical data for multiple stocks (for example, GAFA).
```{r}
# get historical data for multiple stocks. e.g. GAFA
tq_get(c("GOOGL","AMZN","FB","AAPL"), get="stock.prices")
```

Create a multiple line chart of the closing prices of the four stocks (for example, GAFA). We can show each stock in a different color on the same graph.
```{r}
# Create a multiple line chart of the closing prices of the four stocks,
# showing each stock in a different color on the same graph.
tq_get(c("GOOGL","AMZN","FB","AAPL"), get="stock.prices") %>%
  ggplot(aes(date, close, color=symbol)) +
  geom_line()
```

Transform the data so each stock begins at 100 and replot. (Standardize the data so that we can compare timeseries) 
```{r}
# Create a multiple line chart of the closing prices of the four stocks,
# showing each stock in a different color on the same graph.
# Transform the data so each stock begins at 100 and replot.
tq_get(c("GOOGL","AMZN","FB","AAPL"), get="stock.prices") %>%
  group_by(symbol) %>%
  mutate(close = 100*close/first(close)) %>%
  ggplot(aes(date, close, color=symbol)) +
  geom_line()
```

Calculate monthly return of multiple stocks (for example, GAFA).
```{r}
# calculate monthly return of multiple stocks
tq_get(c("GOOGL","AMZN","FB","AAPL"), get="stock.prices") %>%
  group_by(symbol) %>%
  tq_transmute(select=adjusted,
               mutate_fun=periodReturn,
               period="monthly",
               col_rename = "monthly_return")
```

Create a multiple line chart of monthly return of the four stocks (for example, GAFA). We can show each stock in a different color on the same graph.
```{r}
# Create a multiple line chart of monthly return of the four stocks,
# showing each stock in a different color on the same graph
tq_get(c("GOOGL","AMZN","FB","AAPL"), get="stock.prices") %>%
  group_by(symbol) %>%
  tq_transmute(select=adjusted,
               mutate_fun=periodReturn,
               period="monthly",
               col_rename = "monthly_return") %>%
  ggplot(aes(date, monthly_return, color=symbol)) +
  geom_line()
```